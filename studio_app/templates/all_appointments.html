{% extends "layout.html" %}

{% block custom_styles %}
<style>
      
      .container {
        max-width: 960px;
      }
      
      .pricing-header {
        max-width: 700px;
      }
</style>
{% endblock %}

{% block title %}
Appointsments
{% endblock %}
{% block content %}
<script>var user_appoint = {{user_appoint | safe}}; console.log(user_appoint); </script>
<!-- [
0    "Not admin Dmitrii",
1    6,
2    "combo",
3    404,
4    0,
5    0,
6    0,
7    120,
8    2024,
9    1,
10    10,
11    11,
12    30,
13    "hi!",
14    "zibubu",
15    "1763"
16    "Sun 31 Dec - 10:00 AM"
17    1
] -->

{% for appointment in user_appoint %}
<div class="container py-2 bg-transparent">
<div class="card mb-4 rounded-3 shadow-sm">
    <div class="card-header py-1 
    {% if appointment[5]==1 %}
    bg-success 
    {% else %}
    bg-warning
    {% endif %}
    bg-gradient" >
      <div class="fs-5 fw-normal row"><div class="col">{{appointment[16]}}</div><div class="col text-end">
        {% if appointment[5]==1 %}
        Confirmed 
        {% else %}
        Pending
        {% endif %}
    </div></div>
    </div>
    <div class="card-body">
      <div class="card-title pricing-card-title text-dark fs-5 fw-normal ">{{appointment[0]}} ({{appointment[14]}}) <small class="text-dark fw-light">: {{appointment[2]}}</small></div>
      <div class="text-dark fw-normal">
        <span>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-telephone" viewBox="0 0 16 16">
            <path d="M3.654 1.328a.678.678 0 0 0-1.015-.063L1.605 2.3c-.483.484-.661 1.169-.45 1.77a17.568 17.568 0 0 0 4.168 6.608 17.569 17.569 0 0 0 6.608 4.168c.601.211 1.286.033 1.77-.45l1.034-1.034a.678.678 0 0 0-.063-1.015l-2.307-1.794a.678.678 0 0 0-.58-.122l-2.19.547a1.745 1.745 0 0 1-1.657-.459L5.482 8.062a1.745 1.745 0 0 1-.46-1.657l.548-2.19a.678.678 0 0 0-.122-.58L3.654 1.328zM1.884.511a1.745 1.745 0 0 1 2.612.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.678.678 0 0 0 .178.643l2.457 2.457a.678.678 0 0 0 .644.178l2.189-.547a1.745 1.745 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.634 18.634 0 0 1-7.01-4.42 18.634 18.634 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877L1.885.511z"/>
          </svg> 
          {{appointment[15]}}
        </span>  
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-instagram" viewBox="0 0 16 16">
            <path d="M8 0C5.829 0 5.556.01 4.703.048 3.85.088 3.269.222 2.76.42a3.917 3.917 0 0 0-1.417.923A3.927 3.927 0 0 0 .42 2.76C.222 3.268.087 3.85.048 4.7.01 5.555 0 5.827 0 8.001c0 2.172.01 2.444.048 3.297.04.852.174 1.433.372 1.942.205.526.478.972.923 1.417.444.445.89.719 1.416.923.51.198 1.09.333 1.942.372C5.555 15.99 5.827 16 8 16s2.444-.01 3.298-.048c.851-.04 1.434-.174 1.943-.372a3.916 3.916 0 0 0 1.416-.923c.445-.445.718-.891.923-1.417.197-.509.332-1.09.372-1.942C15.99 10.445 16 10.173 16 8s-.01-2.445-.048-3.299c-.04-.851-.175-1.433-.372-1.941a3.926 3.926 0 0 0-.923-1.417A3.911 3.911 0 0 0 13.24.42c-.51-.198-1.092-.333-1.943-.372C10.443.01 10.172 0 7.998 0h.003zm-.717 1.442h.718c2.136 0 2.389.007 3.232.046.78.035 1.204.166 1.486.275.373.145.64.319.92.599.28.28.453.546.598.92.11.281.24.705.275 1.485.039.843.047 1.096.047 3.231s-.008 2.389-.047 3.232c-.035.78-.166 1.203-.275 1.485a2.47 2.47 0 0 1-.599.919c-.28.28-.546.453-.92.598-.28.11-.704.24-1.485.276-.843.038-1.096.047-3.232.047s-2.39-.009-3.233-.047c-.78-.036-1.203-.166-1.485-.276a2.478 2.478 0 0 1-.92-.598 2.48 2.48 0 0 1-.6-.92c-.109-.281-.24-.705-.275-1.485-.038-.843-.046-1.096-.046-3.233 0-2.136.008-2.388.046-3.231.036-.78.166-1.204.276-1.486.145-.373.319-.64.599-.92.28-.28.546-.453.92-.598.282-.11.705-.24 1.485-.276.738-.034 1.024-.044 2.515-.045v.002zm4.988 1.328a.96.96 0 1 0 0 1.92.96.96 0 0 0 0-1.92zm-4.27 1.122a4.109 4.109 0 1 0 0 8.217 4.109 4.109 0 0 0 0-8.217zm0 1.441a2.667 2.667 0 1 1 0 5.334 2.667 2.667 0 0 1 0-5.334"/>
          </svg> <a href="https://www.instagram.com/{{appointment[14]}}/" target="_blank">{{appointment[14]}}</a>
              </div>
      <div class="mb-2 text-dark fw-normal">
        {{appointment[13]}} 
      </div>
      <div class="row">
      
      <button type="button" class="col m-1 w-100 btn btn-lg btn-primary py-1 mb-1" data-toggle="modal" data-target="#editModal" data-booking_id="{{appointment[3]}}" data-id="{{appointment[17]}}" data-date="{{appointment[16]}}" data-service="{{appointment[2]}}" data-client="{{appointment[0]}} ({{appointment[14]}})" data-time="{{appointment[11]}}:{% if appointment[12]<10 %}0{% endif %}{{appointment[12]}}" data-date_picker_format="{{appointment[8]}}-{% if appointment[9]<10 %}0{{appointment[9]}}{% else %}{{appointment[9]}}{% endif %}-{% if appointment[10]<10 %}0{{appointment[10]}}{% else %}{{appointment[10]}}{% endif %}" data-duration="{{appointment[7]}}" data-message="{{appointment[13]}}">Edit</button>
      <button
      {% if appointment[5]==1 %}
       disabled  
      {% endif %}
      type="button" class="col m-1 w-100 btn btn-lg btn-warning py-1 mb-1" data-toggle="modal" data-target="#confirmModal" data-booking_id="{{appointment[3]}}" data-id="{{appointment[17]}}" data-date="{{appointment[16]}}" data-service="{{service}}" data-client="{{appointment[0]}} ({{appointment[14]}})">Confirm</button>
      
    </div>
    <div class="row"> 
      <button 
      {% if appointment[5]==0 %}
      disabled  
     {% endif %}
      type="button" class="col m-1 w-100 btn btn-lg btn-success py-1 mb-1" data-toggle="modal" data-target="#doneModal" data-booking_id="{{appointment[3]}}" data-id="{{appointment[17]}}" data-date="{{appointment[16]}}" data-service="{{service}}" data-client="{{appointment[0]}} ({{appointment[14]}})">Done</button>
      <button type="button" class="col m-1 w-100 btn btn-lg btn-danger py-1 mb-1" data-toggle="modal" data-target="#cancelModal" data-booking_id="{{appointment[3]}}" data-id="{{appointment[17]}}" data-date="{{appointment[16]}}" data-service="{{service}}" data-client="{{appointment[0]}} ({{appointment[14]}})">Cancel</button>
    </div>
    </div>
  </div>
</div>
{% endfor %}

<table class="table">
    <thead>
      <tr class="text-danger">
        <th scope="col">Date</th>
        <th scope="col">Time</th>
        <th scope="col">Client</th>
        <th scope="col">Sevice</th>
        <th scope="col">Duration</th>
        <th scope="col">Aproved</th>
        <th scope="col">Status</th>
      </tr>
    </thead>
    <tbody class="text-white">

        {% for appointment in user_appoint %}
        <tr class="my-table-hover">
            <th scope="row">{{appointment[9]}}/{{appointment[10]}}</th>
            <td>{{appointment[11]}} :
                {% if appointment[12] == 0 %}
                00
                {% else %}
                {{appointment[12]}}
                {% endif %}
            </td>
            <td>{{appointment[0]}}</td>
            <td>{{appointment[2]}}</td>
            <td>{{appointment[7]}} min</td>
            <td>
                {% if appointment[5] == 0 %}
                    ...not yet
                {% else %}
                    Aproved
                {% endif %}
            </td>
            <td>
               
                    {% if appointment[4] == 1 %}
                        Done
                    {% elif appointment[6] == 1 %}
                        Canceled
                    {% else %}
                        ...waiting
                    {% endif %}
                
                <!--
                    <form action="/all_appointments/" method="post">
                    <input type="hidden" name="appointment_id" value={{appointment[1]}}>
                    <input type="submit" value="edit">
                    </form>
                --> 

            </td>
          </tr>
        {% endfor %}
    </tbody>
  </table>

  <div class="modal fade text-dark" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <form action="/edit_appointment/" method="post">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editModalLabel">Edit appointment</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <span class="mb-1" id="date_edit"></span>, <span class="mb-1" id="service_edit"></span> for <span class="mb-1" id="client_edit"></span>
            <div class="row mb-1 ml-1">
                      
                    <label class="mx-1 px-1 col-4"  for="new_date">Date</label>             
                    <input class="col-4" type="date"   name="new_date" id="new_date">                     
                

            </div>
            <div class="row mb-1 ml-1">
                <span class="mx-1 px-1 col-4">Time </span>  <input class="col-4" type="time" name="new_time" id="new_time">
                
            </div>
            <div class="row mb-1 ml-1">
                <span class="mx-1 px-1 col-4"> Duration (min)</span><input class="col-4" type="number" min="0" max="300" name="new_duration" id="new_duration">
                
            </div>
            <div class="form-check">
                <input type="checkbox" class="form-check-input" id="new_manicure" name="new_manicure">
                <label class="form-check-label" for="new_manicure">manicure</label>
              </div>
    
              <div class="form-check">
                <input type="checkbox" class="form-check-input" id="new_pedicure" name="new_pedicure">
                <label class="form-check-label" for="new_pedicure">pedicure</label>
              </div>
            <div class="form-group">
              <label for="new_message" class="col-form-label">Message:</label>
              <textarea class="form-control" id="new_message" name="new_message" placeholder="add message if needed"></textarea>
            </div>
          
        </div>
        <input type="text" name="user_id_edit" id="user_id_edit" hidden>
        <input type="text" name="booking_id_edit" id="booking_id_edit" hidden>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">go back</button>
          <button type="submit" class="btn btn-danger">save</button>
        </div>
      </div>
    </form>
    </div>
  </div>

  <div class="modal fade text-dark" id="cancelModal" tabindex="-1" role="dialog" aria-labelledby="cancelModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <form>
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="cancelModalLabel">Cancel appointment</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <span id="date_cancel"></span>, <span id="service_cancel"></span> for <span id="client_cancel"></span>
            <div class="form-group">
              <label for="cancel_message" class="col-form-label">Message:</label>
              <textarea class="form-control" id="cancel_message" placeholder="can you please write about reasons"></textarea>
            </div>
          
        </div>
        <input type="text" name="user_id_cancel" id="user_id_cancel" hidden>
        <input type="text" name="booking_id_cancel" id="booking_id_cancel" hidden>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">No, go back</button>
          <button type="button" type="submit" class="btn btn-danger">Delete this booking forever</button>
        </div>
      </div>
    </form>
    </div>
  </div>
  <div class="modal fade text-dark" id="doneModal" tabindex="-1" role="dialog" aria-labelledby="doneModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <form>
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="doneModalLabel">Success</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <span id="date_done"></span>, <span id="service_done"></span> for <span id="client_done"></span>
        </div>
        <input type="text" name="user_id_done" id="user_id_done" hidden>
        <input type="text" name="booking_id_done" id="booking_id_done" hidden>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">No, go back</button>
          <button type="button" type="submit" class="btn btn-danger">ok, it is finished</button>
        </div>
      </div>
    </form>
    </div>
  </div>

  <div class="modal fade text-dark" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="confirmModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <form action="/confirm_appointment/" method="post">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="confirmModalLabel">Confirm appointment</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
        <span id="date_confirm"></span>, <span id="service_confirm"></span> for <span id="client_confirm"></span>
        </div>
        <input type="text" name="user_id_confirm" id="user_id_confirm" hidden>
        <input type="text" name="booking_id_confirm" id="booking_id_confirm" hidden>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">No, go back</button>
          <button type="submit" class="btn btn-danger">Confirm booking</button>
        </div>
      </div>
    </form>
    </div>
  </div>
  <script>


    document.addEventListener("DOMContentLoaded", () => {
       // data-date="{{get_this_date}}" data-service="{{service}}" data-client="{{client}}"
        $('#cancelModal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget) // Button that triggered the modal
            var user_id_cancel  = button.data('id') 
            var booking_id_cancel = button.data('booking_id')
            var date_cancel = button.data('date')
            var service_cancel = button.data('service')
            var name_cancel = button.data('client')
            console.log(user_id_cancel, booking_id_cancel, date_cancel, service_cancel, name_cancel)// Extract info from data-* attributes
            // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
            // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
            var modal = $(this)            
            modal.find('#user_id_cancel').val(user_id_cancel)
            modal.find('#booking_id_cancel').val(booking_id_cancel)
            modal.find('#date_cancel').text(date_cancel)
            modal.find('#service_cancel').text(service_cancel)
            modal.find('#client_cancel').text(name_cancel)
          })

          $('#editModal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget) // Button that triggered the modal
            var user_id_edit = button.data('id') 
            var booking_id_edit = button.data('booking_id')
            var date_edit = button.data('date')
            var service_edit = button.data('service')
            var name_edit = button.data('client')
            var time_edit = button.data('time')
            var date_picker_format_edit = button.data('date_picker_format')
            var duration_edit = button.data('duration')
            var message_edit = button.data('message')
            
            // Extract info from data-* attributes
            // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
            // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
            var modal = $(this)            
            modal.find('#user_id_edit').val(user_id_edit)
            modal.find('#booking_id_edit').val(booking_id_edit)
            modal.find('#date_edit').text(date_edit)
            modal.find('#service_edit').text(service_edit)
            modal.find('#client_edit').text(name_edit)
            modal.find('#new_time').val(time_edit)
            modal.find('#new_date').val(date_picker_format_edit)
            console.log(date_picker_format_edit)
            modal.find('#new_duration').val(duration_edit)
            modal.find('#new_message').val(message_edit)
            console.log(service_edit)
            if (service_edit == "manicure") {
              modal.find('#new_manicure').attr('checked', true)
              modal.find('#new_pedicure').attr('checked', false)
            } else if (service_edit == "pedicure") {

              modal.find('#new_pedicure').attr('checked', true)
              modal.find('#new_manicure').attr('checked', false)
            } else if (service_edit == "combo") {
              console.log("combo")
              modal.find('#new_manicure').attr('checked', true)
              modal.find('#new_pedicure').attr('checked', true)
            }
          })

          $('#confirmModal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget) // Button that triggered the modal
            var user_id_confirm  = button.data('id') 
            var booking_id_confirm = button.data('booking_id')
            var date_confirm = button.data('date')
            var service_confirm = button.data('service')
            var name_confirm = button.data('client')
            console.log(user_id_confirm, booking_id_confirm, date_confirm, service_confirm, name_confirm)// Extract info from data-* attributes
            // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
            // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
            var modal = $(this)            
            modal.find('#user_id_confirm').val(user_id_confirm)
            modal.find('#booking_id_confirm').val(booking_id_confirm)
            modal.find('#date_confirm').text(date_confirm)
            modal.find('#service_confirm').text(service_confirm)
            modal.find('#client_confirm').text(name_confirm)
          })

          $('#doneModal').on('show.bs.modal', function (event) {
            var button = $(event.relatedTarget) // Button that triggered the modal
            var user_id_done  = button.data('id') 
            var booking_id_done = button.data('booking_id')
            var date_done = button.data('date')
            var service_done = button.data('service')
            var name_done = button.data('client')
            console.log(user_id_done, booking_id_done, date_done, service_done, name_done)// Extract info from data-* attributes
            // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
            // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
            var modal = $(this)            
            modal.find('#user_id_done').val(user_id_done)
            modal.find('#booking_id_done').val(booking_id_done)
            modal.find('#date_done').text(date_done)
            modal.find('#service_done').text(service_done)
            modal.find('#client_done').text(name_done)
          })
    })

  </script>


{% endblock %}